//#include <SFML/Graphics.hpp>
#include <array>
#include <cmath>
#include <cstddef>
#include <matplot/matplot.h>
#include <numeric>
#include <set>
#include <vector>
#include "EulerMaruyama.h"


double norm(double N){
   if(N >= 10)
      return norm(N/10);
   else if(N < 1.0)
      return norm(N * 10);

   return N;
}

int main(){

   constexpr double D { 2.2e-5 };

   constexpr int MAX_NUM_STEPS {10};
   constexpr int NUM_ITER {100};

   std::array<double, MAX_NUM_STEPS> res {};
   res.fill(0);

   std::cout << "res[1]: " << res[1] << '\n';
   for(std::size_t i {0}; i <MAX_NUM_STEPS; ++i){
      for(int j { 0 }; j < NUM_ITER; ++j){
         EulerMaruyama<2> em (1, i+1, { 0 }, 0, std::sqrt(2 * D));
         em.run();
         res[i] += em.getTotalWalk();
      }
   }

   //normalize res to be between 1 and 10
   for(auto& e : res){
      e = e/NUM_ITER;
      std::cout << "before: " << e << '\n';
      e = norm(e);
      std::cout << "after: " << e << "\n\n";
   }


   /*
   const int NUM_TESTS { 10 };
   double results[NUM_TESTS] = {0, 0, 0, 0, 0, 0, 0, 0, 0, 0};
   const int steps[NUM_TESTS] = {1, 5, 10, 50, 100, 500, 1000, 5000, 10000, 50000};
   constexpr int NUM_ITER { 100 };
   for(std::size_t i { 0 }; i < NUM_TESTS; ++i){
      for(int j { 0 }; j < NUM_ITER; ++j){
         EulerMaruyama<2> em (1, steps[i], { 0 }, 0, std::sqrt(2 * D));
         em.run();
         results[i] += em.getTotalWalk();

         if(j % (NUM_ITER/10) == 0)
            std::cout << "Iteration #" << j << " on step #" << i << '\n';
      }
   }

   std::cout << "\n\n///////////////////////////////////////////////////////////\n";
   for(int i { 0 }; i < NUM_TESTS; ++i){
      std::cout << "The average total walk after " << NUM_ITER << " iterations for " << steps[i] << " is: " << results[i]/NUM_ITER << '\n';
   }

   std::cout << "\n\n///////////////////////////////////////////////////////////\n";
   for(int i { 0 }; i < NUM_TESTS; ++i){
      std::cout << "The average walk size after " << NUM_ITER << " iterations for " << steps[i] << " is: " << (results[i]/NUM_ITER)/steps[i] << '\n';
   }
   */

   /*
   std::vector<double> x { };
   std::vector<double> t { };
   
   for(std::size_t i { 0 }; i < 5; ++i){
      EulerMaruyama<2> em (1, 100, {0}, 0, std::sqrt(2 * D));
      auto results = em.run();
      for(const auto& e : results){
         x.emplace_back(e.first[0]);
         t.emplace_back(e.second);
      }
      std::set<double> a;

      auto p = matplot::plot(t, x);
   }

   matplot::show();
   */
}

